{% extends 'app/base.html' %}
{% load static %} 
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

    {% block main-content %}
    <div style = "display: flex ; width: 100% ; align-content: center ; justify-content: center ; background-color : #f2f2f2 ; height : 100vh" class="User_view">
       <div style = "display: flex ; background-color : white ; width : 70% ; height : 90% ; margin-top :20px">
           <div class="information_view">
               <div class="name_and_image">
                {% if image is not None %}
                       <img src= "/static/images/{{image}}" class="user_image" alt="user_image" style="width: 50px; height: 50px;">
                {% else %}
                       <img src= {%static 'app/images/avt.png' %} class="user_image" alt="user_image" style="width: 50px; height: 50px;">
                {% endif %}
                   <div class="name_info">
                       <label class="info">Tài khoản này thuộc về</label><br>
                       <label class="name">{{request.user}}</label>
                   </div>
               </div>
               <ul class="user_nav_bar">
                   <li style = "list-style-type: none ; padding-left: 20px ; padding-right: 20px" class="nav_row">
                       <a href="../1" class="row">Thông tin chung</a>
                   </li>
                   {% if author %}
                   <li style = "list-style-type: none ; padding-left: 20px ; padding-right: 20px  " class="nav_row">
                       <a href="../2" class="row">Thông tin tài khoản</a>
                   </li>
                   {% endif %}
                   <li style = "list-style-type: none ; padding-left: 20px ; padding-right: 20px  " class="nav_row">
                       <a href="../3" class="row">Truyện theo dõi</a>
                   </li>
                   {% if author %}
                   <li style = "list-style-type: none ; padding-left: 20px ; padding-right: 20px  " class="nav_row">
                       <a href="../4" class="row">Đổi mật khẩu</a>
                   </li>
                   {% endif %}

                   {% if author %}
                   <li style = "list-style-type: none ; padding-left: 20px ; padding-right: 20px  " class="nav_row">
                       <a href="../5" class="row">Đăng truyện</a>
                   </li>
                   {% endif %}

                   {% if author %}
                   <li style = "list-style-type: none  ; padding-left: 20px ; padding-right: 20px  " class="nav_row">
                       <a href="../6" class="row">Truyện đã đăng</a>
                   </li>
                   {% endif %}

                   {% comment %} {% if author %}
                   <li style = "list-style-type: none" class="nav_row">
                       <a href="../7" class="row">Thông báo</a>
                   </li>
                   {% endif %} {% endcomment %}
               </ul>
           </div>
            {% if tabnumber == '1' %}
                <div class="content_view">
                    <div class="Detail_content" style="margin: 10px;">
                        <label style="font-size: 24px; font-weight: bold;">THÔNG TIN CHUNG</label>
                    </div>
                    <div class="Detail_content" style="margin: 20px;">
                        <label style="font-size: 16px; border-left: 4px solid rgb(255, 0, 0); font-weight: bold;">THÔNG TIN TÀI KHOẢN</label>
                    </div>
                    <div class="Detail_information">
                        <label class="information_row">Email: {{user.email}}</label><br>
                    </div>
        
                    <div style = "overflow-y: scroll width : 100%" class="Favor ">
                        <div class="Detail_content" style="margin: 20px;">
                            <label style="font-size: 16px; border-left: 4px solid rgb(255, 0, 0); font-weight: bold;">TRUYỆN THEO DÕI</label>
                        </div>
                        <div style = "display: flex ; align-items: center ; gap : 10px"   >
                            {% for manga in mangaList %}
                                {% if manga is not None %}
                                    <a style = "margin : 40px 0px" href="/manga/{{ manga.idManga }}">
                                        <div style="width : 260px ; height : 420px;  cursor : pointer; margin-top :20px" >
                                        <div style = "border : 1px solid #ccc ; margin-bottom : 10px ; border-radius : 5px ; padding : 5px">
                                            <img style = "object-fit : contain;" src= "/static/images/{{manga.image}}"/>
                                        </div>
                        
                                        <div>
                                            <a style="font-weight : bold; font-size : 15px ; width : full" >{{manga.name}}</a>
                                        </div>
                                        <span>
                                            <i style="color : yellow;" class="fa-sharp fa-solid fa-star"></i>
                                            5
                                        </span>
                                        </div>
                                    </a> 
                                {% endif %}
                                 
                            {% endfor %}
                        </div>
                    </div>
        
                    {% comment %} <div class="Favor">
                        <div class="Detail_content" style="margin: 20px;">
                            <label style="font-size: 16px; border-left: 4px solid rgb(255, 0, 0); font-weight: bold;">TRUYỆN ĐÃ ĐĂNG</label>
                        </div>
        
                        <div class="Favor_list-view" style="margin: 20px;">
                            <!-- phần trên list -->
                            <div class="heading-list-favor">
                                <div class="col-name">Tên truyện</div>
                                <div class="col-update">Ngày đăng</div>
                                <div class="col-view">Nội dung</div>
                            </div>
                            
                            <!-- list các trương -->
                            <div class="list-chapter">
                                <ul class="list-chapter-review">
                                    <li class="favor-row">
                                        <div class="favor-name">ĐẠI BÀNG TUNG CÁNH</div>
                                        <div class="favor-update">hahahah</div>
                                        <div class="favor-chapter">70000</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div> {% endcomment %}
                </div>
            {% elif tabnumber == '2' %}
                <div class="content_view">
                    <div class="Detail_content" style="margin: 10px;">
                        <label style="font-size: 24px; font-weight: bold;">Cập nhật thông tin tài khoản</label>
                    </div>
                    <div class="Detail_content" style="margin: 20px;">
                        <label style="font-size: 16px; border-left: 4px solid rgb(255, 0, 0); font-weight: bold;">THÔNG TIN TÀI KHOẢN</label>
                    </div>
                    <form style="width: 23rem; margin-left : 20px" method="POST" action="">
                        {% csrf_token %}
                                <div style = "display: flex ; flex-direction: column; margin-bottom : 10px" class="form-outline mb-4 ">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Tài Khoản</label>
                                    <input value = {{user.username}} name = "username" style = "padding : 5px" />
                                </div>
                    
                                <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Email</label>
                                    <input value = {{user.email}} name = "email" style = "padding : 5px"   />
                                </div>  

                                <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                    <label style = "font-weight: bold" class="form-label" for="form2Example18">Image</label>
                                    <input name = "image"  accept = "image/*,video/*"  type="file"  id="" />
                                </div>  
                        <div class="pt-1 mb-4">
                          <button style = "padding: 5px ; cursor: pointer ; background-color: #337ab7 ; outline: none ; color : white" name = "dk" class="btn btn-info btn-lg btn-block" type="submit">Cập nhật</button>
                        </div>
            
                     </form> 
        
              
                </div>
            {% elif tabnumber == '3' %}
                <div class="content_view">
                    <div class="Detail_content" style="margin: 10px;">
                        <label style="font-size: 24px; font-weight: bold;">TRUYỆN THEO DÕI</label>
                    </div>
                    <div style = "display: flex ; align-items: center ; gap : 10px"   >
                        {% for manga in mangaList %}
                            {% if manga is not None %}
                                <a style = "margin : 40px 0px" href="/manga/{{ manga.idManga }}">
                                    <div style="width : 260px ; height : 420px;  cursor : pointer; margin-top :20px" >
                                    <div style = "border : 1px solid #ccc ; margin-bottom : 10px ; border-radius : 5px ; padding : 5px">
                                        <img style = "object-fit : contain;" src= "/static/images/{{manga.image}}"/>
                                    </div>
                    
                                    <div>
                                        <a style="font-weight : bold; font-size : 15px ; width : full" >{{manga.name}}</a>
                                    </div>
                                    <span>
                                        <i style="color : yellow;" class="fa-sharp fa-solid fa-star"></i>
                                        5
                                    </span>
                                    </div>
                                </a> 
                            {% endif %}
                             
                        {% endfor %}
                    </div>
        
                    {% comment %} <div class="Favor">
                        <div class="Detail_content" style="margin: 20px;">
                            <label style="font-size: 16px; border-left: 4px solid rgb(255, 0, 0); font-weight: bold;">TRUYỆN ĐÃ ĐĂNG</label>
                        </div>
        
                        <div class="Favor_list-view" style="margin: 20px;">
                            <!-- phần trên list -->
                            <div class="heading-list-favor">
                                <div class="col-name">Tên truyện</div>
                                <div class="col-update">Ngày đăng</div>
                                <div class="col-view">Nội dung</div>
                            </div>
                            
                            <!-- list các trương -->
                            <div class="list-chapter">
                                <ul class="list-chapter-review">
                                    <li class="favor-row">
                                        <div class="favor-name">ĐẠI BÀNG TUNG CÁNH</div>
                                        <div class="favor-update">hahahah</div>
                                        <div class="favor-chapter">70000</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div> {% endcomment %}
                </div>
            {% elif tabnumber == '4' %}
              <div class="content_view">

                <div class="Detail_content" style="margin: 10px;">
                    <label style="font-size: 24px; font-weight: bold;">Đổi Mật Khẩu</label>
                </div>

                <form style="width: 23rem; margin-left : 20px" method="POST" action="">
                    {% csrf_token %}
                            <div style = "display: flex ; flex-direction: column; margin-bottom : 10px" class="form-outline mb-4 ">
                            <label style = "font-weight: bold" class="form-label" for="form2Example18">Mật khẩu mới</label>
                                <input value = "" name = "newpassword" style = "padding : 5px" />
                            </div>
                
                            <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                            <label style = "font-weight: bold" class="form-label" for="form2Example18">Xác nhận mật khẩu mới</label>
                                <input value = "" name = "newpassword2" style = "padding : 5px"   />
                            </div>  

                         
                    <div class="pt-1 mb-4">
                      <button style = "padding: 5px ; cursor: pointer ; background-color: #337ab7 ; outline: none ; color : white" name = "dk" class="btn btn-info btn-lg btn-block" type="submit">Đổi mật khẩu</button>
                    </div>
        
                </form> 
            {% elif tabnumber == '5' %}
                <div class="content_view">
                    <div class="Detail_content" style="margin: 10px;">
                        <label style="font-size: 24px; font-weight: bold;">Đăng truyện</label>
                    </div>
                    <div class="Detail_content" style="margin: 20px;">
                        <label style="font-size: 16px; border-left: 4px solid rgb(255, 0, 0); font-weight: bold;">THÔNG TIN TRUYỆN</label>
                    </div>
                    <form style="width: 23rem; margin-left : 20px" method="POST" action="">
                        {% csrf_token %}
                                <div style = "display: flex ; flex-direction: column; margin-bottom : 10px" class="form-outline mb-4 ">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Tên truyện</label>
                                    <input value = "" name = "mangaName" style = "padding : 5px" />
                                </div>
                    
                                <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Giới thiệu</label>
                                    <textarea value = "" name = "descriptionManga" style = "padding : 5px"></textarea>
                                </div>  

                                <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                    <label style = "font-weight: bold" class="form-label" for="form2Example18">Thể loại</label>
                                     <select name = "type"  >
                                        {% for type in typeList %}
                                            <option value = {{forloop.counter}} >{{type}}</option>
                                        {% endfor %}
                                     </select>
                                </div>  

                                <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                    <label style = "font-weight: bold" class="form-label" for="form2Example18">Trạng thái</label>
                                     <select name = "status"  >
                                        {% for status in statusList %}
                                            <option value = {{forloop.counter}} >{{status}}</option>
                                        {% endfor %}
                                     </select>
                                </div>  

                                <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                    <label style = "font-weight: bold" class="form-label" for="form2Example18">Image</label>
                                    <input name = "imageManga"  accept = "image/*,video/*"  type="file" name="img" id="" />
                                </div>  
                        <div class="pt-1 mb-4">
                        <button style = "padding: 5px ; cursor: pointer ; background-color: #337ab7 ; outline: none ; color : white" name = "dk" class="btn btn-info btn-lg btn-block" type="submit">Thêm truyện</button>
                        </div>
            
                    </form> 
        
            
                </div>
            {% elif tabnumber == '6' %}
            <div style = "width : 100%; " class="content_view">
                <div class="Detail_content" style="margin: 10px;">
                    <label style="font-size: 24px; font-weight: bold;">TRUYỆN ĐÃ ĐĂNG</label>
                </div>
                <div style = "display: flex ; align-items: center ; gap : 10px ; flex-wrap : wrap ; overflow-y: scroll ; height: 400px ; width : 100%"   >
                    {% for manga in mangaOwnerList %}
                        {% if manga is not None %}
                            <a style = "margin : 40px 0px" href="/manga/{{ manga.idManga }}">
                                <div style="width : 260px ; height : 420px;  cursor : pointer; margin-top :20px" >
                                <div style = "border : 1px solid #ccc ; margin-bottom : 10px ; border-radius : 5px ; padding : 5px">
                                    <img style = "object-fit : contain;" src= "/static/images/{{manga.image}}"/>
                                </div>
                
                                <div>
                                    <a style="font-weight : bold; font-size : 15px ; width : full" >{{manga.name}}</a>
                                </div>
                                {% comment %} <span>
                                    <i style="color : yellow;" class="fa-sharp fa-solid fa-star"></i>
                                    5
                                </span> {% endcomment %}

                                <div style = "display: flex ; align-items: center ; gap : 5px" >
                                   
                                        
                                        <button  type="button" data-bs-toggle="modal" data-bs-whatever={{manga.idManga}}
                                         data-bs-name={{manga.name}} data-bs-des= {{manga.description}}
                                         data-bs-target="#exampleModal"
                                         data-bs-type= {{manga.category}}
                                         data-bs-status= {{manga.status}}
                                         data-bs-image= {{manga.image}}

                                          class="btn btn-primary">Update</button>
                                        <form method="POST" action=""  >
                                            {% csrf_token %}
                                            <input type="hidden" name="idDelete" value="{{manga.idManga}}"/>
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                        <button type="button" data-bs-toggle="modal" data-bs-whatever={{manga.idManga}} data-bs-target="#chapterModal" class="btn btn-success">Add</button>
                                   
                                </div>
                            </a> 
                        {% endif %}
                         
                    {% endfor %}
                </div>
            </div>
            {% else %}
                 <table class="table table-hover  ">
                <thead>
                  <tr>
                    <th scope="col">Stt</th>
                    <th scope="col">TÊN TRUYỆN</th>
                    <th scope="col">LƯỢT XEM</th>
                  </tr>
                </thead>
                <tbody>
                    {% for manga in mangaOwnerList %}
                    <th scope="row">1</th>
                    <td>{{mange.name}}</td>
                    <td>{{manga.}}</td>
                    {% endfor %}
                  <tr>
                  </tr>
                </tbody>
              </table>
                   
            {% endif %}    
            {% if messages %}
            {% for message in messages %}    
                    <script type=text/javascript>
                          alert('{{ message }}');
                    </script>
            {% endfor %}
        {% endif %}
       </div> 
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Update</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form style="width: 23rem; margin-left : 20px" method="POST" action="">
                    {% csrf_token %}
                           <input type = "hidden" name = "idManga" value = "" class = "idManga" />
                            <div style = "display: flex ; flex-direction: column; margin-bottom : 10px" class="form-outline mb-4 ">
                            <label style = "font-weight: bold" class="form-label" for="form2Example18">Tên truyện</label>
                                <input class = "nameMangeNew" value = "" name = "mangaName" style = "padding : 5px" />
                            </div>
                
                            <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                            <label style = "font-weight: bold" class="form-label" for="form2Example18">Giới thiệu</label>
                                <textarea class = "descriptionMangaNew" value = "" name = "descriptionManga" style = "padding : 5px"></textarea>
                            </div>  

                            <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Thể loại</label>
                                 <select class = "typeMangaNew" name = "type"  >
                                    {% for type in typeList %}
                                        <option value = {{type}} >{{type}}</option>
                                    {% endfor %}
                                 </select>
                            </div>  

                            <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Trạng thái</label>
                                 <select class = "statusMangaNew" name = "status"  >
                                    {% for status in statusList %}
                                        <option value = {{status}} >{{status}}</option>
                                    {% endfor %}
                                 </select>
                            </div>  

                            <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                                <label style = "font-weight: bold" class="form-label" for="form2Example18">Image</label>
                                <input value = "" class = "imgMangaNew" name = "imageManga"  accept = "image/*,video/*"   type="file" name="img" id="" />
                            </div>  
                    <div class="pt-1 mb-4">
                    <button style = "padding: 5px ; cursor: pointer ; background-color: #337ab7 ; outline: none ; color : white" name = "dk" class="btn btn-info btn-lg btn-block" type="submit">Thêm truyện</button>
                    </div>
        
                </form> 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              {% comment %} <button type="button" class="btn btn-primary">Save changes</button> {% endcomment %}
            </div>
          </div>
        </div>
    </div>

      <div class="modal fade" id="chapterModal" tabindex="-1" aria-labelledby="chapterModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Add</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form style="width: 23rem; margin-left : 20px" method="POST" action="">
                    {% csrf_token %}
                           <input type = "hidden" name = "idChapter" value = "" class = "idChapter" />
                            <div style = "display: flex ; flex-direction: column; margin-bottom : 10px" class="form-outline mb-4 ">
                            <label style = "font-weight: bold" class="form-label" for="form2Example18">Tên Chapter</label>
                                <input class = "nameMangeNew" value = "" name = "chapterName" style = "padding : 5px" />
                            </div>
                
                            <div style = "display: flex ; flex-direction: column;  margin-bottom : 10px "  class="form-outline mb-4">
                            <label style = "font-weight: bold" class="form-label" for="form2Example18">Nội dung</label>
                                <textarea class = "descriptionMangaNew" value = "" name = "chapterContent" style = "padding : 5px"></textarea>
                            </div>  

                           
                    <div class="pt-1 mb-4">
                    <button style = "padding: 5px ; cursor: pointer ; background-color: #337ab7 ; outline: none ; color : white" name = "dk" class="btn btn-info btn-lg btn-block" type="submit">Thêm truyện</button>
                    </div>
        
                </form> 
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              {% comment %} <button type="button" class="btn btn-primary">Save changes</button> {% endcomment %}
            </div>
          </div>
        </div>
      </div>
      <script>
           var exampleModal = document.getElementById('exampleModal')
            exampleModal.addEventListener('show.bs.modal', function (event) {
            // Button that triggered the modal
            var button = event.relatedTarget
            // Extract info from data-bs-* attributes
            var idManga = button.getAttribute('data-bs-whatever')

            var name = button.getAttribute('data-bs-name')

            var des = button.getAttribute('data-bs-des')

            var type = button.getAttribute('data-bs-type')

            var status = button.getAttribute('data-bs-status')

            console.log(status)

            var image = button.getAttribute('data-bs-image')

            console.log(image)






            console.log(typeof idManga)

            console.log(name)
            // If necessary, you could initiate an AJAX request here
            // and then do the updating in a callback.
            //
            // Update the modal's content.
            var modalTitle = exampleModal.querySelector('.modal-title')

            var nameInput = exampleModal.querySelector('.nameMangeNew')

            var desInput = exampleModal.querySelector('.descriptionMangaNew')

            var statusInput = exampleModal.querySelector('.statusMangaNew')

            var typeInput = exampleModal.querySelector('.typeMangaNew')

            var imageInput = exampleModal.querySelector('.imgMangaNew')


            



            var idMangaInput = exampleModal.querySelector('.idManga')
          
            idMangaInput.value  = idManga
            
            nameInput.value = name

            desInput.value = des

            statusInput.value = status

            typeInput.value = type

            imageInput.files = "sssssssssssssssssssss"

        })

        var addModal = document.getElementById('chapterModal')
                addModal.addEventListener('show.bs.modal', function (event) {
                // Button that triggered the modal
                var button = event.relatedTarget
                // Extract info from data-bs-* attributes
                var recipient = button.getAttribute('data-bs-whatever')
                // If necessary, you could initiate an AJAX request here
                // and then do the updating in a callback.
                //
                // Update the modal's content.

                console.log(recipient)
                var modalBodyInput = addModal.querySelector('.idChapter')

               
                modalBodyInput.value = recipient
                })
      </script>
    {% endblock main-content %}


